datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// =================================================================================
// MODELOS DE MÍDIA PRINCIPAIS
// =================================================================================

model Filme {
  id              Int       @id @default(autoincrement())
  tmdbId          Int       @unique
  imdbId          String?   @unique
  title           String
  originalTitle   String?
  overview        String?   @db.Text
  releaseDate     DateTime?
  runtime         Int?
  budget          BigInt?
  revenue         BigInt?
  popularity      Float?
  voteAverage     Float?
  voteCount       Int?
  status          String?
  tagline         String?
  homepage        String?
  posterPath      String?
  backdropPath    String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relacionamentos
  genres          FilmeGenero[]
  companies       FilmeCompany[]
  countries       FilmeCountry[]
  languages       FilmeLanguage[]
  cast            FilmeCast[]
  crew            FilmeCrew[]
  videos          Video[]
}

model Serie {
  id               Int       @id @default(autoincrement())
  tmdbId           Int       @unique
  name             String
  originalName     String?
  overview         String?   @db.Text
  firstAirDate     DateTime?
  lastAirDate      DateTime?
  numberOfSeasons  Int?
  numberOfEpisodes Int?
  popularity       Float?
  voteAverage      Float?
  voteCount        Int?
  status           String?
  posterPath       String?
  backdropPath     String?
  homepage         String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // Relacionamentos
  genres           SerieGenero[]
  networks         SerieNetwork[]
  seasons          Temporada[]
  createdBy        SerieCreator[]
  cast             SerieCast[]
  crew             SerieCrew[]
  videos           Video[]
}

model Anime {
  id             Int       @id @default(autoincrement())
  anilistId      Int       @unique
  malId          Int?      @unique
  titleRomaji    String
  titleEnglish   String?
  titleNative    String?
  description    String?   @db.Text
  episodes       Int?
  season         String?
  seasonYear     Int?
  format         String?
  status         String?
  startDate      DateTime?
  endDate        DateTime?
  averageScore   Int?
  meanScore      Int?
  popularity     Int?
  duration       Int?
  source         String?
  siteUrl        String?
  coverImage     String?
  bannerImage    String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relacionamentos
  genres         AnimeOnGenero[]
  studios        AnimeOnStudio[]
  characters     AnimeCharacter[]
  staff          AnimeStaff[]
  streamingLinks AnimeStreamingLink[]
}

model Jogo {
  id                    Int       @id @default(autoincrement())
  igdbId                Int       @unique
  name                  String
  slug                  String?
  summary               String?   @db.Text
  storyline             String?   @db.Text
  firstReleaseDate      DateTime?
  rating                Float?
  ratingCount           Int?
  aggregatedRating      Float?
  aggregatedRatingCount Int?
  url                   String?
  cover                 String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  // Relacionamentos
  genres                JogoOnGenero[]
  platforms             JogoOnPlataforma[]
  companies             JogoOnCompany[]
  themes                JogoOnTheme[]
  playerPerspectives    JogoOnPlayerPerspective[]
  screenshots           Screenshot[]
  artworks              Artwork[]
  videos                Video[]
  websites              Website[]
}

// =================================================================================
// MODELOS DE ENTIDADES (Pessoas, Gêneros, Empresas, etc.)
// =================================================================================

model Video {
  id        Int     @id @default(autoincrement())
  tmdbId    String? @unique
  key       String
  name      String
  site      String
  type      String
  official  Boolean

  filme   Filme? @relation(fields: [filmeId], references: [id])
  filmeId Int?

  serie   Serie? @relation(fields: [serieId], references: [id])
  serieId Int?

  jogo    Jogo?  @relation(fields: [jogoId], references: [id])
  jogoId  Int?
}

// --- ENTIDADES: FILMES E SÉRIES ---

model Genero {
  id     Int    @id @default(autoincrement())
  tmdbId Int    @unique
  name   String @unique
  filmes FilmeGenero[]
  series SerieGenero[]
}

model Company {
  id     Int    @id @default(autoincrement())
  tmdbId Int    @unique
  name   String
  filmes FilmeCompany[]
}

model Country {
  id     Int    @id @default(autoincrement())
  iso    String @unique
  name   String
  filmes FilmeCountry[]
}

model Language {
  id     Int    @id @default(autoincrement())
  iso    String @unique
  name   String
  filmes FilmeLanguage[]
}

model Pessoa {
  id          Int     @id @default(autoincrement())
  tmdbId      Int     @unique
  name        String
  profilePath String?
  filmeCast   FilmeCast[]
  filmeCrew   FilmeCrew[]
  serieCast   SerieCast[]
  serieCrew   SerieCrew[]
  createdBy   SerieCreator[]
}

model Network {
  id       Int     @id @default(autoincrement())
  tmdbId   Int     @unique
  name     String
  logoPath String?
  series   SerieNetwork[]
}

model Temporada {
  id           Int       @id @default(autoincrement())
  tmdbId       Int       @unique
  airDate      DateTime?
  episodeCount Int?
  name         String
  overview     String?   @db.Text
  posterPath   String?
  seasonNumber Int
  serie        Serie     @relation(fields: [serieId], references: [id])
  serieId      Int
}

// --- ENTIDADES: ANIMES ---

model AnimeGenero {
  id     Int    @id @default(autoincrement())
  name   String @unique
  animes AnimeOnGenero[]
}

model AnimeStudio {
  id        Int    @id @default(autoincrement())
  anilistId Int    @unique
  name      String @unique
  animes    AnimeOnStudio[]
}

model Personagem {
  id        Int     @id @default(autoincrement())
  anilistId Int     @unique
  name      String
  image     String?
  animes    AnimeCharacter[]
}

model Dublador {
  id                   Int      @id @default(autoincrement())
  anilistId            Int      @unique
  name                 String
  language             String
  image                String?
  personagens_dublados AnimeCharacter[]
}

model MembroStaff {
  id                 Int     @id @default(autoincrement())
  anilistId          Int     @unique
  name               String
  image              String?
  animes_trabalhados AnimeStaff[]
}

model AnimeStreamingLink {
  id        Int     @id @default(autoincrement())
  url       String
  site      String
  thumbnail String?
  anime     Anime   @relation(fields: [animeId], references: [id])
  animeId   Int
}

// --- ENTIDADES: JOGOS ---

model JogoGenero {
  id     Int    @id @default(autoincrement())
  igdbId Int    @unique
  name   String @unique
  jogos  JogoOnGenero[]
}

model JogoPlataforma {
  id     Int    @id @default(autoincrement())
  igdbId Int    @unique
  name   String @unique
  jogos  JogoOnPlataforma[]
}

model JogoCompany {
  id        Int     @id @default(autoincrement())
  igdbId    Int     @unique
  name      String
  developer Boolean
  publisher Boolean
  jogos     JogoOnCompany[]
}

model JogoTheme {
  id     Int    @id @default(autoincrement())
  igdbId Int    @unique
  name   String @unique
  jogos  JogoOnTheme[]
}

model JogoPlayerPerspective {
  id     Int    @id @default(autoincrement())
  igdbId Int    @unique
  name   String @unique
  jogos  JogoOnPlayerPerspective[]
}

model Screenshot {
  id     Int     @id @default(autoincrement())
  igdbId String  @unique
  url    String
  jogo   Jogo    @relation(fields: [jogoId], references: [id])
  jogoId Int
}

model Artwork {
  id     Int     @id @default(autoincrement())
  igdbId String  @unique
  url    String
  jogo   Jogo    @relation(fields: [jogoId], references: [id])
  jogoId Int
}

model Website {
  id       Int    @id @default(autoincrement())
  igdbId   Int
  category Int
  url      String
  jogo     Jogo   @relation(fields: [jogoId], references: [id])
  jogoId   Int
}


// =================================================================================
// TABELAS DE JUNÇÃO (MUITOS-PARA-MUITOS EXPLÍCITAS)
// =================================================================================

// --- JUNÇÕES: FILMES ---

model FilmeGenero {
  filme    Filme  @relation(fields: [filmeId], references: [id])
  filmeId  Int
  genero   Genero @relation(fields: [generoId], references: [id])
  generoId Int

  @@id([filmeId, generoId])
}

model FilmeCompany {
  filme     Filme   @relation(fields: [filmeId], references: [id])
  filmeId   Int
  company   Company @relation(fields: [companyId], references: [id])
  companyId Int

  @@id([filmeId, companyId])
}

model FilmeCountry {
  filme     Filme   @relation(fields: [filmeId], references: [id])
  filmeId   Int
  country   Country @relation(fields: [countryId], references: [id])
  countryId Int

  @@id([filmeId, countryId])
}

model FilmeLanguage {
  filme      Filme    @relation(fields: [filmeId], references: [id])
  filmeId    Int
  language   Language @relation(fields: [languageId], references: [id])
  languageId Int

  @@id([filmeId, languageId])
}

model FilmeCast {
  filme       Filme   @relation(fields: [filmeId], references: [id])
  filmeId     Int
  pessoa      Pessoa  @relation(fields: [pessoaId], references: [id])
  pessoaId    Int
  character   String?
  order       Int?

  @@id([filmeId, pessoaId])
}

model FilmeCrew {
  filme      Filme  @relation(fields: [filmeId], references: [id])
  filmeId    Int
  pessoa     Pessoa @relation(fields: [pessoaId], references: [id])
  pessoaId   Int
  job        String?
  department String?

  @@id([filmeId, pessoaId]) // Removed 'job' as it is optional
}

// --- JUNÇÕES: SÉRIES ---

model SerieGenero {
  serie    Serie  @relation(fields: [serieId], references: [id])
  serieId  Int
  genero   Genero @relation(fields: [generoId], references: [id])
  generoId Int

  @@id([serieId, generoId])
}

model SerieNetwork {
  serie     Serie   @relation(fields: [serieId], references: [id])
  serieId   Int
  network   Network @relation(fields: [networkId], references: [id])
  networkId Int

  @@id([serieId, networkId])
}

model SerieCreator {
  serie    Serie  @relation(fields: [serieId], references: [id])
  serieId  Int
  pessoa   Pessoa @relation(fields: [pessoaId], references: [id])
  pessoaId Int

  @@id([serieId, pessoaId])
}

model SerieCast {
  serie       Serie   @relation(fields: [serieId], references: [id])
  serieId     Int
  pessoa      Pessoa  @relation(fields: [pessoaId], references: [id])
  pessoaId    Int
  character   String?
  order       Int?

  @@id([serieId, pessoaId])
}

model SerieCrew {
  serie      Serie  @relation(fields: [serieId], references: [id])
  serieId    Int
  pessoa     Pessoa @relation(fields: [pessoaId], references: [id])
  pessoaId   Int
  job        String?
  department String?

  @@id([serieId, pessoaId]) // Removed 'job' as it is optional
}

// --- JUNÇÕES: ANIMES ---

model AnimeOnGenero {
  anime    Anime       @relation(fields: [animeId], references: [id])
  animeId  Int
  genero   AnimeGenero @relation(fields: [generoId], references: [id])
  generoId Int

  @@id([animeId, generoId])
}

model AnimeOnStudio {
  anime     Anime       @relation(fields: [animeId], references: [id])
  animeId   Int
  studio    AnimeStudio @relation(fields: [studioId], references: [id])
  studioId  Int

  @@id([animeId, studioId])
}

model AnimeCharacter {
  anime       Anime      @relation(fields: [animeId], references: [id])
  animeId     Int
  character   Personagem @relation(fields: [characterId], references: [id])
  characterId Int
  dublador    Dublador   @relation(fields: [dubladorId], references: [id])
  dubladorId  Int
  role        String

  @@id([animeId, characterId, dubladorId])
}

model AnimeStaff {
  anime    Anime       @relation(fields: [animeId], references: [id])
  animeId  Int
  staff    MembroStaff @relation(fields: [staffId], references: [id])
  staffId  Int
  role     String

  @@id([animeId, staffId, role])
}

// --- JUNÇÕES: JOGOS ---

model JogoOnGenero {
  jogo     Jogo       @relation(fields: [jogoId], references: [id])
  jogoId   Int
  genero   JogoGenero @relation(fields: [generoId], references: [id])
  generoId Int

  @@id([jogoId, generoId])
}

model JogoOnPlataforma {
  jogo       Jogo           @relation(fields: [jogoId], references: [id])
  jogoId     Int
  plataforma JogoPlataforma @relation(fields: [plataformaId], references: [id])
  plataformaId Int

  @@id([jogoId, plataformaId])
}

model JogoOnCompany {
  jogo      Jogo        @relation(fields: [jogoId], references: [id])
  jogoId    Int
  company   JogoCompany @relation(fields: [companyId], references: [id])
  companyId Int

  @@id([jogoId, companyId])
}

model JogoOnTheme {
  jogo    Jogo      @relation(fields: [jogoId], references: [id])
  jogoId  Int
  theme   JogoTheme @relation(fields: [themeId], references: [id])
  themeId Int

  @@id([jogoId, themeId])
}

model JogoOnPlayerPerspective {
  jogo          Jogo                  @relation(fields: [jogoId], references: [id])
  jogoId        Int
  perspective   JogoPlayerPerspective @relation(fields: [perspectiveId], references: [id])
  perspectiveId Int

  @@id([jogoId, perspectiveId])
}

// =================================================================================
// MODELOS DE USUÁRIO E PREFERÊNCIAS
// =================================================================================

model User {
  id              Int                          @id @default(autoincrement())
  email           String                       @unique
  hashed_password String
  role            String                       @default("user")
  quer_avaliar    Boolean                      @default(true)
  data_criacao    DateTime                     @default(now())

  // Relacionamento com as preferências do usuário
  preferencias    preferencias_usuario_midia[]
}

model preferencias_usuario_midia {
  id             Int      @id @default(autoincrement())
  usuario_id     Int
  midia_id       Int      // O ID da API externa (TMDB, Anilist, IGDB)
  tipo_midia     String   // 'filme', 'serie', 'anime', 'jogo'
  status         String   // 'favorito', 'quero_assistir', 'acompanhando', 'assistido', 'oculto'
  avaliacao      String?  // 'gostei', 'amei', 'nao_gostei'
  data_interacao DateTime @default(now())

  // Relacionamento com o usuário
  usuario        User     @relation(fields: [usuario_id], references: [id])
}
